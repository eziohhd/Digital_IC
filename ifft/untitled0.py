# -*- coding: utf-8 -*-
"""
Created on Tue Apr  2 23:10:03 2024

@author: ezioh
"""
import numpy as np
import math
import matplotlib.pyplot as plt

    
def binary_to_decimal(binary):
    # 检查最高位是否为1，确定正负号
    sign = -1 if binary[0] == '1' else 1
    
    # 如果是负数，取反加1得到原码
    if sign == -1:
        binary = ''.join('1' if bit == '0' else '0' for bit in binary)
        binary = bin(int(binary, 2) + 1)[2:]
    
    # 计算二进制数的值
    decimal = 0
    for i in range(len(binary)):
        decimal += int(binary[-(i+1)]) * (2**i)
    
    return sign * decimal
    
# 示例使用
# trans
bin_str_in_0_re = "11111111011111101111110010110001111110111111111011111110001110001111110011000001111111000111101000000000010000100000001111100111111111100100100011111011011110000000010010000110000001000010101111111110011001000000000101111010000000000010010000000000001101110000000010001000000000110001111111111011000010010000001010111000111111100001111111111011101100001111110100111101111111000010000000000010010011001111111110101101000000001010100100000000011010110000010001001000000000001101111011111111110101010000000010011000"
bin_str_in_1_re = "11111100111111100000001010110000111111110000110000000011000100110000000001001111000000100110001000000000001111010000000111001111000000111010001011111110100000011111101110100100111111111011010111111101010010011111110100100111000000111000110100000010111000011111110010000100111111011100011111111101100001111111110011100011000000001101100011111111011010001111110001001011000000100110110100000000110110100000001011000011111111111100110100000011111101101111110000101011000000001011101100000000100000110000000001010010"
bin_str_in_0_im = "11111101110010010000001110000001111111010010110111111101010110001111110011011011000000111001010011111011001010101111111011000111111111010010111100000001010101001111110001011101111110110010011111111110010110110000010001011011000000100011010011111111100000101111101101000110111111000110010100000100100001000000010011101011111111101001110111111111111000100000001010000101000000011011001100000000101010010000000001011011000000100110011111111011110100100000001001111011111110111011111000000000001101110000000010000110"
bin_str_in_1_im = "11111110011110000000000000001111111110110100000011111101101010000000010000111110000000111110100111111100110110100000001111100010000000001000111000000010011100110000001001110110111111110000101111111011000010111111110110001010111110111101000011111100100110101111111001011101111111110110101000000010111001001111110010110101111111100001000100000011000100101111110101010111000000110000000100000011111011110000001100011110000000000101000100000001100110111111110101011101000000001110111111111110100110110000000010110000"

in_0_re = []
in_1_re = []

for i in range(0,32): #reverse
    bin_temp = bin_str_in_0_re[16*i:16*i+16]
    in_0_re.append(bin_temp)

in_0_re_signed = []
for i in range(0,32):
    in_0_re_signed.append(binary_to_decimal(in_0_re[i]))

for i in range(0,32):
    bin_temp = bin_str_in_1_re[16*i:16*i+16]
    in_1_re.append(bin_temp)

in_1_re_signed = []
for i in range(0,32):
    in_1_re_signed.append(binary_to_decimal(in_1_re[i]))

#add
in_0_re_signed = np.array(in_0_re_signed)
in_0_re_signed = in_0_re_signed[::-1]
in_1_re_signed = np.array(in_1_re_signed)
in_1_re_signed = in_1_re_signed[::-1]
in_0_1_re_signed_sum = in_0_re_signed + in_1_re_signed

layer_2 = []
for i in range(0,16):
    layer_2.append(in_0_1_re_signed_sum[i] + in_0_1_re_signed_sum[i+16]) 
layer_2=np.array(layer_2)

layer_3 = []
for i in range(0,8):
    layer_3.append(layer_2[i] + layer_2[i+8]) 
layer_3=np.array(layer_3)

layer_4 = []
for i in range(0,4):
    layer_4.append(layer_3[i] + layer_3[i+4]) 
layer_4=np.array(layer_4)

w_0 = -254
w_16 = 25
layer_5_0 = layer_4[0] + layer_4[2]
layer_5_1 = layer_4[1] + layer_4[3]
layer_5_2 = (layer_4[0]-layer_4[2])*w_0/256
layer_5_3 = (layer_4[1]-layer_4[3])*w_16/256

layer6_0 = layer_5_0 + layer_5_1
layer6_1 = layer_5_0 - layer_5_1
layer6_2 = layer_5_2 + layer_5_3
layer6_3 = layer_5_2 - layer_5_3
result_exp = binary_to_decimal('1110110111000001')
result_actual = binary_to_decimal('1110010100111001')
zero_re_exp = binary_to_decimal('1111000101010011')
zero_im_exp = binary_to_decimal('1110110111100100')
one_re_exp = binary_to_decimal('1110000010111111')
one_im_exp = binary_to_decimal('1101110011000100')

zero_re_actual = binary_to_decimal('1111000101010011')
zero_im_actual = binary_to_decimal('1110110111100100')
one_re_actual = binary_to_decimal('0001111101000001')
one_im_actual = binary_to_decimal('0010001100111100')

a = [8,9,10]
b= [98312,97088,96028]
plt.plot(a, b)
plt.xlabel('cycle period(ns)')
plt.ylabel('area(um2)')
plt.show()
